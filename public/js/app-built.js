/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/** @license
 * RequireJS plugin for loading JSON files
 * - depends on Text plugin and it was HEAVILY "inspired" by it as well.
 * Author: Miller Medeiros
 * Version: 0.4.0 (2014/04/10)
 * Released under the MIT license
 */

define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("json",["text"],function(text){function cacheBust(e){return e=e.replace(CACHE_BUST_FLAG,""),e+=e.indexOf("?")<0?"?":"&",e+CACHE_BUST_QUERY_PARAM+"="+Math.round(2147483647*Math.random())}var CACHE_BUST_QUERY_PARAM="bust",CACHE_BUST_FLAG="!bust",jsonParse=typeof JSON!="undefined"&&typeof JSON.parse=="function"?JSON.parse:function(val){return eval("("+val+")")},buildMap={};return{load:function(e,t,n,r){r.isBuild&&(r.inlineJSON===!1||e.indexOf(CACHE_BUST_QUERY_PARAM+"=")!==-1)||t.toUrl(e).indexOf("empty:")===0?n(null):text.get(t.toUrl(e),function(t){r.isBuild?(buildMap[e]=t,n(t)):n(jsonParse(t))},n.error,{accept:"application/json"})},normalize:function(e,t){return e.indexOf(CACHE_BUST_FLAG)!==-1&&(e=cacheBust(e)),t(e)},write:function(e,t,n){if(t in buildMap){var r=buildMap[t];n('define("'+e+"!"+t+'", function(){ return '+r+";});\n")}}}}),define("json!config",function(){return{gameHtmlWrapId:"gamewrap",pathToAssets:"/img/",serverSendStateInterval:50,actions:{cooldown:50},buttonFontFamily:"Arial",buttonFontWeight:"normal","interface":{bodyInfo:{fontWeight:"normal",fontFamily:"Arial"}},errors:{minPasswordLength:"Password length must be greater than 3",passwordsDontMatch:"Passwords dont match",emailNotValid:"Enter right email",unknownEmailOrPass:"Unknown email or password",emailBusy:"Email busy",nameNotValid:"Name length must be greater than 3",nameBusy:"Name already busy",serverError:"Server error"},socket:{reconnectWait:6e4}}}),define("modules/render",["require","pixi","json!config"],function(e){var t=e("pixi"),n=e("json!config"),r={};return r.stage,r.layers=[],r.create=function(e){var r=document.getElementById(n.gameHtmlWrapId),i;e=e||{},this.resolution=e.resolution||[window.innerWidth,window.innerHeight],this.render=t.autoDetectRenderer(this.resolution[0],this.resolution[1]),this.render.view.style.display="block",document.getElementById("gamepreloader").style.display="none",r.style.display="block",r.appendChild(this.render.view),this.stage=new t.Stage(0);for(i=0;i<5;i++)this.layers[i]=new t.DisplayObjectContainer,this.stage.addChild(this.layers[i])},r.draw=function(){this.render.render(this.stage)},r}),define("interface/position",["require","modules/render"],function(e){var t=e("modules/render"),n={};return n.CENTER=[0,0],n.TOP=[0,0],n.BOTTOM=[0,0],n.LEFT=[0,0],n.RIGHT=[0,0],n.TOPLEFT=[0,0],n.TOPRIGHT=[0,0],n.BOTTOMLEFT=[0,0],n.BOTTOMRIGHT=[0,0],n.update=function(){this.CENTER=[t.resolution[0]/2,t.resolution[1]/2],this.TOP=[t.resolution[0]/2,0],this.BOTTOM=[t.resolution[0]/2,t.resolution[1]],this.LEFT=[0,t.resolution[1]/2],this.RIGHT=[t.resolution[0],t.resolution[1]/2],this.TOPLEFT=[0,0],this.TOPRIGHT=[t.resolution[0],0],this.BOTTOMLEFT=[0,t.resolution[1]],this.BOTTOMRIGHT=[t.resolution[0],t.resolution[1]]},n}),define("interface/frame",["require","pixi","modules/render","./position"],function(e){var t=e("pixi"),n=e("modules/render"),r=e("./position"),i={},s=function(e){e=e||{},this.width=e.width||0,this.height=e.height||0,e.anchor!==undefined?this.anchor=r[e.anchor]:this.anchor=r.TOPLEFT,this.position=e.position||[0,0],typeof e.onShow=="function"?this.onShow=e.onShow:this.onShow=function(){},this.displayObject=new t.DisplayObjectContainer,this.displayObject.width=this.width,this.displayObject.height=this.height,this.displayObject.position.x=this.anchor[0]+this.position[0],this.displayObject.position.y=this.anchor[1]+this.position[1],this.displayObject.defaultCursor="default",this.width>0&&this.height>0&&(this.displayObject.buttonMode=!0,this.displayObject.interactive=!0,this.displayObject.hitArea=new t.Rectangle(0,0,this.width,this.height)),this.visible=e.visible!==undefined?e.visible:!0,this.displayObject.visible=this.visible,this.displayObject.mousedown=this._mousedown,n.layers[4].addChild(this.displayObject),this.opacity=e.opacity||.5,this.childs={},this._childsIdCounter=0,this._initColor(e.color)};return s.prototype._initColor=function(e){this.color=e;if(this.color===undefined)return;switch(this.color){case"blue":this.strokeColor="1a59e8";break;case"red":this.strokeColor="980707";break;case"orange":this.strokeColor="f66a1d";break;case"green":this.strokeColor="0a912d";break;default:this.strokeColor="1a59e8"}this.spriteBackground=new t.Graphics,this.spriteBackground.lineStyle(1,parseInt("0x"+this.strokeColor,16),this.opacity),this.spriteBackground.beginFill(parseInt("0x"+this.strokeColor,16),this.opacity-.4),this.spriteBackground.drawRect(0,0,this.width,this.height),this.spriteBackground.endFill(),this.displayObject.addChild(this.spriteBackground)},s.prototype.addChild=function(e){e.id=++this._childsIdCounter,this.childs[e.id]=e.id,this.displayObject.addChild(e.displayObject)},s.prototype._mousedown=function(e){e.originalEvent.stopPropagation()},s.prototype.show=function(){this.visible=!0,this.displayObject.visible=!0,this.onShow()},s.prototype.hide=function(){this.visible=!1,this.displayObject.visible=!1},s.prototype.toggle=function(){this.visible=!this.visible,this.displayObject.visible=this.visible,this.visible&&this.onShow()},i.create=function(e){return new s(e)},i}),define("interface/button",["require","lodash","pixi","json!config","./position"],function(e){var t=e("lodash"),n=e("pixi"),r=e("json!config"),i=e("./position"),s={},o=function(e){e=e||{},this.color=e.color||"blue";switch(this.color){case"blue":this.strokeColor="1a59e8";break;case"red":this.strokeColor="980707";break;case"orange":this.strokeColor="f66a1d";break;case"green":this.strokeColor="0a912d"}this.id,this.width=e.width||300,this.height=e.height||50,this.position=e.position||[0,0],this.displayObject=new n.DisplayObjectContainer,this.displayObject.buttonMode=!0,this.displayObject.interactive=!0,this.displayObject.width=this.width,this.displayObject.height=this.height,this.displayObject.position.x=this.position[0],this.displayObject.position.y=this.position[1],this.displayObject.hitArea=new n.Rectangle(0,0,this.width,this.height),e.visible!==undefined&&(this.displayObject.visible=e.visible),this.sprite,this.spriteHover,this.text=e.text||"",this.spriteText,this.fontSize=e.fontSize||22,this._createBackground(),this._createText(),this.displayObject.mouseover=t.bind(this._mouseover,this),this.displayObject.mouseout=t.bind(this._mouseout,this),typeof e.click=="function"?this.clickCallback=e.click:this.clickCallback=function(){},this.displayObject.click=t.bind(this.click,this),this.displayObject.mousedown=this._mousedown};return o.prototype.click=function(){this.clickCallback()},o.prototype._createBackground=function(){this.sprite=new n.Graphics,this.sprite.lineStyle(1,parseInt("0x"+this.strokeColor,16),1),this.sprite.beginFill(parseInt("0x"+this.strokeColor,16),.5),this.sprite.drawRect(0,0,this.width,this.height),this.sprite.endFill(),this.displayObject.addChild(this.sprite),this.spriteHover=new n.Graphics,this.spriteHover.lineStyle(1,parseInt("0x"+this.strokeColor,16),1),this.spriteHover.beginFill(parseInt("0x"+this.strokeColor,16),.7),this.spriteHover.drawRect(0,0,this.width,this.height),this.spriteHover.endFill(),this.spriteHover.visible=!1,this.displayObject.addChild(this.spriteHover)},o.prototype._createText=function(){this.spriteText=new n.Text(this.text,{font:r.buttonFontWeight+" "+this.fontSize+"px "+r.buttonFontFamily,align:"center",fill:"#fff",strokeThickness:1,stroke:"#"+this.strokeColor,wordWrap:!0,wordWrapWidth:this.width}),this.spriteText.position.x=(this.width-this.spriteText.width)/2,this.spriteText.position.y=(this.height-this.spriteText.height)/2,this.displayObject.addChild(this.spriteText)},o.prototype._mousedown=function(e){e.originalEvent.stopPropagation()},o.prototype._mouseover=function(){var e=this;setTimeout(function(){e.sprite.visible=!1,e.spriteHover.visible=!0},0)},o.prototype._mouseout=function(){this.sprite.visible=!0,this.spriteHover.visible=!1},o.prototype.addChild=function(e){this.displayObject.addChild(e.displayObject)},s.create=function(e){return new o(e)},s}),define("modules/key",[],function(){var e={},t={49:1,50:2,51:3,52:4,53:5,54:6,55:7,56:8,57:9,48:0,81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",67:"C",86:"V",66:"B",78:"N",77:"M",17:"CTRL",16:"SHIFT",18:"ALT",13:"ENTER",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",32:"SPACE",8:"BACKSPACE",46:"DELETE",35:"END",36:"HOME",9:"TAB",27:"ESC",MOUSELEFT:"MOUSELEFT",MOUSEMID:"MOUSEMID",MOUSERIGHT:"MOUSERIGHT"},n=[8,9],r={},i={},s=!1,o,u=[13,37,39,8,46,35,36,9];return window.addEventListener("keydown",function(e){var a=e.keyCode||e.which,f;n.indexOf(a)!==-1&&e.preventDefault(),s?u.indexOf(a)!==-1&&o(t[a]):(f=t[a],r[f]=!0,i[f]=!0)}),window.addEventListener("keypress",function(e){var t,n;s&&(t=e.keyCode||e.charCode,t!==13&&(n=String.fromCharCode(t),e.shiftKey&&n.toUpperCase(),o(n)))}),window.addEventListener("keyup",function(e){var n=e.keyCode||e.which;i[t[n]]=!1}),window.addEventListener("wheel",function(e){e.deltaY<0?r.WHEELUP=!0:r.WHEELDOWN=!0}),window.addEventListener("mousedown",function(e){switch(e.which){case 1:i.MOUSELEFT=!0;break;case 2:i.MOUSEMID=!0;break;case 3:i.MOUSERIGHT=!0}}),window.addEventListener("mouseup",function(e){switch(e.which){case 1:i.MOUSELEFT=!1;break;case 2:i.MOUSEMID=!1;break;case 3:i.MOUSERIGHT=!1}}),window.addEventListener("contextmenu",function(e){return e.preventDefault(),!1}),e.pressed=r,e.reset=function(){for(var e in r)r[e]=!1},e.down=i,e.enableWriteText=function(t){s=!0,e.reset(),o=t},e.disableWriteText=function(){s=!1,o=undefined},e}),define("interface/editbox",["require","lodash","pixi","json!config","./position","modules/key"],function(e){var t=e("lodash"),n=e("pixi"),r=e("json!config"),i=e("./position"),s=e("modules/key"),o={},u=function(e){e=e||{},this.color=e.color||"blue";switch(this.color){case"blue":this.strokeColor="1a59e8";break;case"red":this.strokeColor="980707";break;case"orange":this.strokeColor="f66a1d"}this.id,this.width=e.width||300,this.height=e.height||50,this.position=e.position||[0,0],typeof e.onNext=="function"?this.onNext=e.onNext:this.onNext=function(){},this.displayObject=new n.DisplayObjectContainer,this.displayObject.buttonMode=!0,this.displayObject.interactive=!0,this.displayObject.width=this.width,this.displayObject.height=this.height,this.displayObject.position.x=this.position[0],this.displayObject.position.y=this.position[1],this.displayObject.hitArea=new n.Rectangle(0,0,this.width,this.height),this.displayObject.defaultCursor="text",e.visible!==undefined&&(this.displayObject.visible=e.visible),this.isActive=!1,this.sprite,this.text=e.text||"",this.spriteText,this.fontSize=e.fontSize||22,this.paddingLeft=e.paddingLeft||15,this.type=e.type,this.spriteTextHelp,this.mask,this.isTextOverWidth=!1,this._createBackground(),this._createText(),this.cursor,this.cursorInterval,this.cursorIntervalDelay=500,this._createCursor(),this.cursorPosition=this.text.length,this.updateCursor(),this.displayObject.click=t.bind(this._click,this),this.displayObject.mouseover=t.bind(this._mouseover,this),this.displayObject.mouseout=t.bind(this._mouseout,this),this.displayObject.mousedown=this._mousedown};return u.prototype._createBackground=function(){this.sprite=new n.Graphics,this.sprite.lineStyle(1,parseInt("0x"+this.strokeColor,16),1),this.sprite.beginFill(parseInt("0x"+this.strokeColor,16),.5),this.sprite.drawRect(0,0,this.width,this.height),this.sprite.endFill(),this.displayObject.addChild(this.sprite),this.spriteHover=new n.Graphics,this.spriteHover.lineStyle(1,parseInt("0x"+this.strokeColor,16),1),this.spriteHover.beginFill(parseInt("0x"+this.strokeColor,16),.7),this.spriteHover.drawRect(0,0,this.width,this.height),this.spriteHover.endFill(),this.spriteHover.visible=!1,this.displayObject.addChild(this.spriteHover)},u.prototype._createText=function(e){var t={font:r.buttonFontWeight+" "+this.fontSize+"px "+r.buttonFontFamily,align:"left",fill:"#fff",strokeThickness:1,stroke:"#"+this.strokeColor,wordWrap:!0,wordWrapWidth:this.width};this.spriteText=new n.Text(this.text,t),this.spriteText.position.x=this.paddingLeft,this.spriteText.position.y=(this.height-this.spriteText.height)/2,this.displayObject.addChild(this.spriteText),this.spriteTextHelp=new n.Text(this.text,t),this.spriteTextHelp.visible=!1,this.spriteTextHelp.anchor.x=1,this.spriteTextHelp.position.x=this.width-this.paddingLeft,this.spriteTextHelp.position.y=(this.height-this.spriteText.height)/2,this.displayObject.addChild(this.spriteTextHelp),this.maskText=new n.Graphics,this.maskText.beginFill(),this.maskText.drawRect(this.paddingLeft,0,this.width-this.paddingLeft*2,this.height),this.maskText.endFill(),this.displayObject.addChild(this.maskText),this.spriteText.mask=this.maskText,this.spriteTextHelp.mask=this.maskText},u.prototype._createCursor=function(){this.cursor=new n.Graphics,this.cursor.lineStyle(2,16777215,1),this.cursor.moveTo(0,0),this.cursor.lineTo(0,this.fontSize*1.2),this.cursor.position.y=(this.height-this.fontSize*1.2)/2,this.cursor.visible=!1,this.displayObject.addChild(this.cursor)},u.prototype.checkForAlign=function(){this.spriteTextHelp.width>=this.width-this.paddingLeft*2?(this.spriteText.visible=!1,this.spriteTextHelp.visible=!0,this.isTextOverWidth=!0):(this.spriteText.visible=!0,this.spriteTextHelp.visible=!1,this.isTextOverWidth=!1)},u.prototype.updateCursor=function(){var e=this;this.cursorPosition===0?this.cursor.position.x=this.paddingLeft:e.isTextOverWidth?e.cursor.position.x=e.width-e.paddingLeft:e.cursor.position.x=e.paddingLeft+e.spriteTextHelp.width,this.isActive&&(clearInterval(this.cursorInterval),this.cursor.visible=!0,this.cursorInterval=setInterval(function(){e.cursor.visible=!e.cursor.visible},this.cursorIntervalDelay))},u.prototype._cursorLeft=function(){this.cursorPosition>0&&this.cursorPosition--},u.prototype._cursorRight=function(){this.cursorPosition<this.text.length&&this.cursorPosition++},u.prototype._cursorHome=function(){this.cursorPosition=0},u.prototype._cursorEnd=function(){this.cursorPosition=this.text.length},u.prototype._backspace=function(){this.cursorPosition>0&&(this.text=this.text.substr(0,this.cursorPosition-1)+this.text.substr(this.cursorPosition),this.cursorPosition--)},u.prototype._delete=function(){this.cursorPosition<this.text.length&&(this.text=this.text.substr(0,this.cursorPosition)+this.text.substr(this.cursorPosition+1))},u.prototype._addCharToText=function(e){this.text=this.text.substr(0,this.cursorPosition)+e+this.text.substr(this.cursorPosition),this.cursorPosition++},u.prototype._enter=function(e){this.deactive(),this.onNext()},u.prototype._tab=function(e){this.deactive(),this.onNext()},u.prototype.active=function(){var e=this;setTimeout(function(){e.isActive=!0,e.cursorPosition=e.text.length,o._active!==undefined&&o._active.deactive(),o._active=e,e.updateCursor(),s.enableWriteText(function(t){var n;switch(t){case"LEFT":e._cursorLeft();break;case"RIGHT":e._cursorRight();break;case"BACKSPACE":e._backspace();break;case"DELETE":e._delete();break;case"HOME":e._cursorHome();break;case"END":e._cursorEnd();break;case"ENTER":e._enter();break;case"TAB":e._tab();break;default:e._addCharToText(t)}e.type==="pass"?n=(new Array(e.text.length+1)).join("*"):n=e.text,e.spriteText.setText(n),e.spriteTextHelp.setText(n.substr(0,e.cursorPosition)),setTimeout(function(){e.checkForAlign(),e.updateCursor()},30)})},0)},u.prototype.deactive=function(){this.isActive=!1,clearInterval(this.cursorInterval),this.cursor.visible=!1,o._active=undefined,s.disableWriteText()},u.prototype._mousedown=function(e){e.originalEvent.stopPropagation()},u.prototype._click=function(){this.active()},u.prototype._mouseover=function(){var e=this;setTimeout(function(){e.sprite.visible=!1,e.spriteHover.visible=!0},0)},u.prototype._mouseout=function(){this.sprite.visible=!0,this.spriteHover.visible=!1},u.prototype.value=function(){return this.text},u.prototype.addChild=function(e){this.displayObject.addChild(e.displayObject)},o._active=undefined,window.addEventListener("click",function(){o._active!==undefined&&o._active.deactive()}),o.create=function(e){return new u(e)},o}),define("interface/text",["require","lodash","pixi","json!config"],function(e){var t=e("lodash"),n=e("pixi"),r=e("json!config"),i={},s=function(e){e=e||{},this.id,this.text=e.text||"",this.width=e.width||300,this.position=e.position||[0,0],this.fontSize=e.fontSize||22,this.textAlign=e.textAlign||"left",this.color=e.color||"fff",this.anchor=e.anchor||[0,0],this.displayObject=new n.Text(this.text,{font:r.buttonFontWeight+" "+this.fontSize+"px "+r.buttonFontFamily,align:this.textAlign,fill:"#"+this.color,wordWrap:!0,wordWrapWidth:this.width}),this.displayObject.position.x=this.position[0],this.displayObject.position.y=this.position[1],this.displayObject.anchor.x=this.anchor[0],this.displayObject.anchor.y=this.anchor[1],e.visible!==undefined&&(this.displayObject.visible=e.visible)};return s.prototype.setText=function(e){this.text=e,this.displayObject.setText(e)},i.create=function(e){return new s(e)},i}),define("modules/camera",["require","lodash","pixi"],function(e){var t=e("lodash"),n=e("pixi"),r={},i=function o(e,t,r){this.id=++o._idCounter,this.width=e||500,this.height=t||500,this.scale=r||1,this.position=[0,0],this.zoomChangeValue=.1,this.target=[0,0],this.followFunction=this.followToPoint,this.rectangle=new n.Rectangle(0,0,this.width,this.height)};i._idCounter=0,i.prototype.followTo=function(e){t.isArray(e)?(this.target=e,this.followFunction=this.followToPoint):e.body!==undefined?(this.target=e,this.followFunction=this.followToBody):typeof e=="function"&&(this.target=undefined,this.followFunction=e)},i.prototype.getVelocity=function(){var e=[0,0];return this.target!==undefined&&this.target.body!==undefined&&(e=[this.target.body.velocity[0],this.target.body.velocity[1]]),e},i.prototype.followToPoint=function(){return[this.target[0],this.target[1]]},i.prototype.followToBody=function(){return[this.target.body.position[0],this.target.body.position[1]]},i.prototype.update=function(){this.position=this.followFunction()},i.prototype.x=function(e){return(e-this.position[0])*this.scale+this.width/2},i.prototype.y=function(e){return(e-this.position[1])*this.scale+this.height/2},i.prototype.zoomOut=function(){this.scale>=.3&&(this.scale-=this.zoomChangeValue)},i.prototype.zoomIn=function(){this.scale<=1.5&&(this.scale+=this.zoomChangeValue)},i.prototype.containsSprite=function(e){var t=e.getBounds();return this.rectangle.contains(t.x,t.y)?!0:this.rectangle.contains(t.x+t.width,t.y)?!0:this.rectangle.contains(t.x,t.y+t.height)?!0:this.rectangle.contains(t.x+t.width,t.y+t.height)?!0:!1};var s=new i;return r.create=function(e,t,n){return new i(e,t,n)},r.set=function(e){e.update(),s=e},r.get=function(){return s},r.x=function(e){return s.x(e)},r.y=function(e){return s.y(e)},r.update=function(){s.update()},r.scale=function(){return s.scale},r.position=function(){return s.position},r.width=function(){return s.width},r.height=function(){return s.height},r.getVelocity=function(){return s.getVelocity()},r}),define("modules/assets",["require","json!config","pixi"],function(e){function i(){var e=new n.Graphics;return e.beginFill(16777215),e.drawRect(0,0,5,30),e.endFill(),e.generateTexture()}function s(){var e=new n.Graphics;return e.beginFill(16777215),e.drawRect(0,0,10,5),e.endFill(),e.generateTexture()}function o(){r.texture.thrust=i(),r.texture.side=s()}var t=e("json!config"),n=e("pixi"),r={};return r.texture={},r.load=function(e,i){var s=[],u;e.texture.screenArrow="screenarrow.png",e.texture.debug="debug.png",window.JS_ENV==="production"?(e.texture.cameraDebug="debug.png",e.texture.cameraDebugGreen="debug.png",e.texture.cameraDebugYellow="debug.png"):(e.texture.cameraDebug="camera_debug.png",e.texture.cameraDebugGreen="camera_debug_green.png",e.texture.cameraDebugYellow="camera_debug_yellow.png"),e.texture.bg_0="bg_0.png",e.texture.bg_1="bg_1.png",e.texture.bg_2="bg_2.png",e.texture.bg_3="bg_3.png",e.texture.aimRed="aim_red.png",e.texture.bulletGreen="bullet_green.gif",_(e.texture).forEach(function(e){s.push(t.pathToAssets+e)}),u=new n.AssetLoader(s),u.onComplete=function(){_(e.texture).forEach(function(e,i){r.texture[i]=n.Texture.fromImage(t.pathToAssets+e)}),o(),i()},u.load()},r}),define("interface/bodyinfo",["require","lodash","pixi","modules/camera","json!config","modules/render","modules/assets"],function(e){var t=e("lodash"),n=e("pixi"),r=e("modules/camera"),i=e("json!config"),s=e("modules/render"),o=e("modules/assets"),u={};u.list={};var a=0,f=function(e){this.id=++a,this.body=e.body,this.colorName=e.colorName||"fff",this.colorHp=e.colorHp||"fff",this.fontSize=e.fontSize||16,this.padding=30,this.displayObject=new n.DisplayObjectContainer,s.layers[4].addChild(this.displayObject),this.spriteName,this.spriteHp,this.createName(),this.createHp(),this.update()};return f.prototype.createName=function(){this.spriteName=new n.Text(this.body.name,{font:i.interface.bodyInfo.fontWeight+" "+this.fontSize+"px "+i.interface.bodyInfo.fontFamily,fill:"#"+this.colorName,strokeThickness:1}),this.spriteName.anchor.x=1,this.displayObject.addChild(this.spriteName)},f.prototype.createHp=function(){this.spriteHp=new n.Text(Math.floor(this.body.hp),{font:i.interface.bodyInfo.fontWeight+" "+this.fontSize+"px "+i.interface.bodyInfo.fontFamily,align:"center",fill:"#"+this.colorHp,strokeThickness:1}),this.spriteHp.anchor.x=0,this.displayObject.addChild(this.spriteHp)},f.prototype.update=function(){this.displayObject.position.x=this.body.sprite.position.x,this.displayObject.position.y=this.body.sprite.position.y,this.spriteHp.setText(Math.floor(this.body.hp)),this.spriteHp.position.x=5,this.spriteHp.position.y=-this.padding-this.body.spriteSize/2*this.body.sprite.scale.y,this.spriteName.position.x=-5,this.spriteName.position.y=-this.padding-this.body.spriteSize/2*this.body.sprite.scale.y},u.create=function(e){var t=new f(e);return u.list[t.id]=t,t},u.update=function(){t(u.list).forEach(function(e){e.update()})},u}),define("interface/index",["require","./frame","./button","./editbox","./text","./bodyinfo"],function(e){var t={};return t.frame=e("./frame"),t.button=e("./button"),t.editbox=e("./editbox"),t.text=e("./text"),t.bodyInfo=e("./bodyinfo"),t}),define("interface/frames/disconnect",["require","interface/index"],function(e){var t=e("interface/index"),n={},r,i,s,o,u,a;n.show=function(e){r=t.frame.create({anchor:"CENTER",color:"red",position:[-200,-50],width:400,height:100,opacity:.9}),i=t.text.create({text:"Disconnect...",position:[200,30],anchor:[.5,.5]}),r.addChild(i),s=t.text.create({text:"",position:[200,65],anchor:[.5,.5]}),r.addChild(s),n.show=f,f(e)};var f=function(e){u=e,a=Date.now(),r.show(),s.setText(Math.ceil(u/1e3)),o=setInterval(function(){var e=Math.max(Math.ceil((u-(Date.now()-a))/1e3),0);s.setText(e)},1e3)};return n.hide=function(){r.hide(),clearInterval(o)},n.setTime=function(e){s.setText(e)},n}),define("modules/request",["require","socketio","json!config","interface/frames/disconnect"],function(e){var t=e("socketio"),n=e("json!config"),r=e("interface/frames/disconnect"),i={},s=t.connect(location.origin,{reconnectionDelay:1e3,reconnectionDelayMax:1e3}),o=0,u=function(){},a=function(){};return s.on("disconnect",function(){o=Date.now(),r.show(n.socket.reconnectWait),u()}).on("reconnect_failed",function(){console.log("reconnect_failed")}).on("reconnect",function(){r.hide(),a()}),i.disconnect=function(e){u=e},i.reconnect=function(e){a=e},i.gameInit=function(e){s.once(2,function(t){e(t)}),s.emit(1)},i.changeStatusToPlayer=function(e){s.once(6,function(t){e(t)})},i.onUpdateGameState=function(e){s.on(3,function(t){e(t)})},i.sendToServer=function(e){s.emit(5,e)},i.signUp=function(e,t,n){s.once("signupAnswer",function(e){n(e)}),s.emit("signup",{email:e,pass:t})},i.enterName=function(e,t){s.once("enterNameAnswer",function(e){t(e)}),s.emit("enterName",{name:e})},i.login=function(e,t,n){s.once("loginAnswer",function(e){n(e)}),s.emit("login",{email:e,pass:t})},i.quickStart=function(){s.emit("quickStart")},i.onGameClose=function(e){s.on("gameClose",function(){e()})},i.ping=function(e){s.once(8,e),s.emit(7)},i}),define("modules/user",["require"],function(e){var t=function(t){this.id=t[0],this.ship,this.actions={}};return t.prototype.setShip=function(e){var t=this;this.ship=e,_(this.ship.actions).forEach(function(e,n){t.actions[n]=e})},t}),define("modules/player",["require","lodash","modules/request"],function(e){var t=e("lodash"),n=e("modules/request"),r={};return r.user,r.actions={},r.setUser=function(e){var n=this;this.user=e,t(this.user.actions).forEach(function(e,t){n.actions[t]=e})},r.action=function(e,t){this.actions[t].check(e)},r.sendActionToServer=function(){var e={},i=!1;t(r.actions).forEach(function(t,n){t.checked&&(e[n]=t.getInfo(),t.reset(),i=!0)}),i&&n.sendToServer(e)},r}),define("utils",[],function(){var e={};return e.inherits=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},e}),define("actions/action",["require","json!config"],function(e){var t=e("json!config"),n=function(n){this.cooldown=n.cooldown||t.actions.cooldown,this.durationAnimation=n.durationAnimation||t.serverSendStateInterval*2+this.cooldown,this.lastTimeUsed=0,this.checked=!1};return n.prototype._run=function(){},n.prototype.use=function(e){this.lastTimeUsed=e,this._run()},n.prototype.check=function(e){this.checked||e-this.lastTimeUsed>this.cooldown&&(this.checked=!0)},n.prototype.reset=function(){this.checked=!1},n.prototype.isAnimate=function(e){return e-this.lastTimeUsed<this.durationAnimation},n.prototype.getInfo=function(){return 0},n}),define("actions/move",["require","utils","./action"],function(e){var t=e("utils"),n=e("./action"),r=["thrust","reverse","left","right",null,"strafeLeft","strafeRight","angularBrake"],i=function s(e){s.super_.apply(this,arguments),this.ship=e.body,this.moveName=r[e.name-1]};return t.inherits(i,n),i}),define("actions/fire",["require","utils","./action"],function(e){var t=e("utils"),n=e("./action"),r=function i(e){i.super_.apply(this,arguments),this.cooldown=100,this.ship=e.body,this.weapons=e.weapons};return t.inherits(r,n),r.prototype.getInfo=function(){return _.map(this.weapons,function(e){return Math.floor(e.getAngle()*100)/100})},r}),define("actions/index",["require","./move","./fire"],function(e){var t=e("./move"),n=e("./fire"),r={};return r.create=function(e){var r;switch(e.name){case 1:r=new t(e);break;case 2:r=new t(e);break;case 3:r=new t(e);break;case 4:r=new t(e);break;case 5:r=new n(e);break;case 6:r=new t(e);break;case 7:r=new t(e);break;case 8:r=new t(e)}return r},r}),define("body/body",["require","p2","pixi","lodash","modules/camera","modules/assets","actions/index","modules/render"],function(e){var t=e("p2"),n=e("pixi"),r=e("lodash"),i=e("modules/camera"),s=e("modules/assets"),o=e("actions/index"),u=e("modules/render"),a=function(t){this.id=t[0],this.type=t[1],this.body,this.sprite,this.spriteSize=100,this.shape,this.game,this.name=t[9]||"Unknown",this.hp=t[7],this.actions={},this.actionsArray=[]};return a.prototype.createBody=function(e){this.body=new t.Body({mass:e[8],position:e[2],velocity:e[3],damping:0,angularVelocity:e[4],angularDamping:0,angle:e[5]}),this.body._gameBody=this},a.prototype.applyShape=function(){},a.prototype.applyActions=function(){var e=this;r(this.actionsArray).forEach(function(t){e.actions[t]=o.create({body:e,name:t})})},a.prototype.createSprite=function(){},a.prototype.addToGame=function(e){e.world.addBody(this.body),u.layers[2].addChild(this.sprite),this.game=e},a.prototype.removeFromGame=function(){this.game.world.removeBody(this.body),u.layers[2].removeChild(this.sprite),this.game=undefined},a.prototype.updateSprite=function(){this.sprite.position.x=i.x(this.body.position[0]),this.sprite.position.y=i.y(this.body.position[1]),this.sprite.rotation=this.body.angle,this.sprite.scale=new n.Point(i.scale(),i.scale())},a.prototype.update=function(e,t){this.body.position[0]=t[2][0],this.body.position[1]=t[2][1],this.body.velocity[0]=t[3][0],this.body.velocity[1]=t[3][1],this.body.angularVelocity=t[4],this.body.angle=t[5],this.hp=t[7]},a.prototype.updateActions=function(e,t){var n=this;r(t[6]).forEach(function(t){n.action(e,t)})},a.prototype.action=function(e,t){this.actions[t]!==undefined&&this.actions[t].use(e)},a.prototype.destroy=function(){this.game!==undefined&&this.game.removeBody(this),this.body._gameBody=undefined},a}),define("body/mask",[],function(){var e={};return e.BODY=Math.pow(2,0),e.SHIP=Math.pow(2,1),e.BULLET=Math.pow(2,2),e}),define("body/asteroid",["require","p2","pixi","utils","./body","modules/assets","./mask"],function(e){var t=e("p2"),n=e("pixi"),r=e("utils"),i=e("./body"),s=e("modules/assets"),o=e("./mask"),u=function a(e){a.super_.apply(this,arguments)};return r.inherits(u,i),u.prototype.applyShape=function(){this.shape=new t.Circle(87.5),this.shape.collisionGroup=o.BODY,this.shape.collisionMask=o.BODY|o.SHIP|o.BULLET,this.body.addShape(this.shape)},u.prototype.createSprite=function(){this.sprite=new n.Sprite(s.texture.asteroid),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5},u}),define("body/rectangle",["require","p2","pixi","utils","./body","modules/assets"],function(e){var t=e("p2"),n=e("pixi"),r=e("utils"),i=e("./body"),s=e("modules/assets"),o=function u(e){u.super_.apply(this,arguments)};return r.inherits(o,i),o.prototype.applyShape=function(){this.body.addShape(new t.Rectangle(100,100))},o.prototype.createSprite=function(){this.sprite=new n.Sprite(s.texture.rectangle),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5},o}),define("body/weapons/index",["require","pixi","lodash","modules/assets","modules/render","modules/camera"],function(e){function a(e){var t=e>0?1:-1;return t*((Math.abs(e)+Math.PI)%(Math.PI*2)-Math.PI)}var t=e("pixi"),n=e("lodash"),r=e("modules/assets"),i=e("modules/render"),s=e("modules/camera"),o={},u=1,f=function(t){this.id=t.id,this.parent=t.parent,this.angularVelocity=5,this.toAngle=t.angle||0,this.position=t.position||[0,0],this.radius=200,this.angle=0};return f.prototype.step=function(e){var t=this.angularVelocity*e,n=a(this.angle-this.toAngle),r=n>0?1:-1;n=Math.abs(n),n<t?this.angle=this.toAngle:n<Math.PI*2-n?this.angle=this.angle-r*t:this.angle=this.angle+r*t},f.prototype.createAim=function(){this.spriteAim=new t.Sprite(r.texture.aimRed),this.spriteAim.width=20,this.spriteAim.height=20,this.spriteAim.anchor.x=.5,this.spriteAim.anchor.y=.5},f.prototype.updateAim=function(){var e=this.angle,t=Math.abs(a(e-this.toAngle)),n=this.parent.body.angle,r=[this.position[0]*Math.cos(n)-this.position[1]*Math.sin(n),this.position[0]*Math.sin(n)+this.position[1]*Math.cos(n)];t<Math.PI/16&&(e=this.toAngle),this.spriteAim.position.x=r[0]*s.scale()+this.radius*Math.cos(e+n)+i.resolution[0]/2,this.spriteAim.position.y=r[1]*s.scale()+this.radius*Math.sin(e+n)+i.resolution[1]/2},f.prototype.goto=function(e){var t=[e.x-i.resolution[0]/2,e.y-i.resolution[1]/2],n=this.parent.body.angle,r=[this.position[0]*Math.cos(n)-this.position[1]*Math.sin(n),this.position[0]*Math.sin(n)+this.position[1]*Math.cos(n)];r=[r[0]*s.scale(),r[1]*s.scale()],this.toAngle=Math.atan2(t[1]-r[1],t[0]-r[0])-n,this.updateAim()},f.prototype.getAngle=function(){return this.angle},o.create=function(e){return e=e||{},e.id=u++,new f(e)},o}),define("modules/step",["require","lodash"],function(e){var t=e("lodash"),n={};n.go=function(e){t(r).forEach(function(t){t.step(e)})};var r={};return n.addWeapon=function(e){r[e.id]=e},n.removeWeapon=function(e){r[e.id]!==undefined&&delete r[e.id]},n}),define("body/ships/ship",["require","utils","p2","lodash","pixi","../body","json!config","modules/assets","modules/camera","../mask","../weapons/index","modules/step","actions/index","modules/render"],function(e){var t=e("utils"),n=e("p2"),r=e("lodash"),i=e("pixi"),s=e("../body"),o=e("json!config"),u=e("modules/assets"),a=e("modules/camera"),f=e("../mask"),l=e("../weapons/index"),c=e("modules/step"),h=e("actions/index"),p=e("modules/render"),d=function v(e){v.super_.apply(this,arguments),this.weapons=[]};return t.inherits(d,s),d.prototype.applyActions=function(){var e=this,t=[1,2,3,4,6,7,8];r(t).forEach(function(t){e.actions[t]=h.create({body:e,name:t})}),this.actions[5]=h.create({body:this,name:5,weapons:this.weapons})},d.prototype.applyWeapons=function(){this.weapons[0]=l.create({position:[-10,0],parent:this}),this.weapons[1]=l.create({position:[10,0],parent:this})},d.prototype.weaponsAimActivate=function(){this.weapons[0].createAim(),p.layers[4].addChild(this.weapons[0].spriteAim),this.weapons[1].createAim(),p.layers[4].addChild(this.weapons[1].spriteAim)},d.prototype.weaponsGoto=function(e){r(this.weapons).forEach(function(t){t.goto(e)})},d.prototype.applyShape=function(){this.shape=new n.Rectangle(60,40),this.shape.collisionGroup=f.SHIP,this.shape.collisionMask=f.BODY|f.SHIP|f.BULLET,this.body.addShape(this.shape)},d.prototype.createSprite=function(){function t(t,n){var r=new i.Sprite(u.texture.side);return r.position.x=t,r.position.y=n,e.sprite.addChild(r),r}var e=this;this.sprite=new i.Sprite(u.texture.ship),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.spriteSize=60,this.spriteThrust=new i.Sprite(u.texture.thrust),this.spriteThrust.anchor.x=0,this.spriteThrust.anchor.y=.5,this.spriteThrust.position.x=-45,this.spriteThrust.position.y=0,this.sprite.addChild(this.spriteThrust),this.spriteReverse=new i.Sprite(u.texture.thrust),this.spriteReverse.anchor.x=0,this.spriteReverse.anchor.y=.5,this.spriteReverse.position.x=21,this.spriteReverse.position.y=0,this.spriteReverse.height=30,this.spriteReverse.width=20,this.sprite.addChild(this.spriteReverse),this.spriteSide=[],this.spriteSide[0]=t(-30,-35),this.spriteSide[1]=t(0,-35),this.spriteSide[2]=t(-30,10),this.spriteSide[3]=t(0,10),this.applyWeapons()},d.prototype.updateSprite=function(e){this.sprite.position.x=a.x(this.body.position[0]),this.sprite.position.y=a.y(this.body.position[1]),this.sprite.rotation=this.body.angle,this.sprite.scale=new i.Point(a.scale(),a.scale()),this.spriteThrust.visible=this.actions[1].isAnimate(e),this.spriteReverse.visible=this.actions[2].isAnimate(e),this.spriteSide[0].visible=!1,this.spriteSide[1].visible=!1,this.spriteSide[2].visible=!1,this.spriteSide[3].visible=!1,this.actions[3].isAnimate(e)?(this.spriteSide[0].visible=!0,this.spriteSide[3].visible=!0):this.actions[4].isAnimate(e)?(this.spriteSide[1].visible=!0,this.spriteSide[2].visible=!0):this.actions[6].isAnimate(e)?(this.spriteSide[2].visible=!0,this.spriteSide[3].visible=!0):this.actions[7].isAnimate(e)&&(this.spriteSide[0].visible=!0,this.spriteSide[1].visible=!0)},d.prototype.addToGame=function(e){e.world.addBody(this.body),r(this.weapons).forEach(function(e){c.addWeapon(e)}),p.layers[2].addChild(this.sprite),this.game=e},d}),define("body/bullets/bullet",["require","p2","pixi","utils","../body","modules/assets","../mask","modules/camera"],function(e){var t=e("p2"),n=e("pixi"),r=e("utils"),i=e("../body"),s=e("modules/assets"),o=e("../mask"),u=e("modules/camera"),a=function f(e){f.super_.apply(this,arguments)};return r.inherits(a,i),a.prototype.createBody=function(e){this.body=new t.Body({mass:1,position:e[2]||[0,0],velocity:e[3]||[0,0],damping:0,angularVelocity:0,angularDamping:0,angle:0}),this.body._gameBody=this},a.prototype.applyShape=function(){this.shape=new t.Circle(1),this.shape.collisionGroup=o.BULLET,this.shape.collisionMask=o.BODY|o.SHIP,this.shape.sensor=!0,this.body.addShape(this.shape)},a.prototype.createSprite=function(){this.sprite=new n.Sprite(s.texture.bulletGreen),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.rotation=Math.atan2(this.body.velocity[1],this.body.velocity[0])},a.prototype.update=function(e){this.body.position[0]=e[2][0],this.body.position[1]=e[2][1],this.body.velocity[0]=e[3][0],this.body.velocity[1]=e[3][1]},a.prototype.updateSprite=function(){this.sprite.position.x=u.x(this.body.position[0]),this.sprite.position.y=u.y(this.body.position[1]),this.sprite.scale=new n.Point(u.scale(),u.scale())},a.prototype.updateActions=function(){},a}),define("body/index",["require","./asteroid","./rectangle","./ships/ship","./bullets/bullet"],function(e){var t=e("./asteroid"),n=e("./rectangle"),r=e("./ships/ship"),i=e("./bullets/bullet"),s={};return s.create=function(e){var s,o;e=e||[],o=e[1]||2;switch(o){case 1:s=new t(e);break;case 2:s=new n(e);break;case 10:s=new r(e);break;case 1e3:s=new i(e);break;default:s=new n(e)}return s.createBody(e),s.applyShape(),s.createSprite(),s.applyActions(),s.updateSprite(),s},s}),define("modules/ping",["require","lodash","modules/request"],function(e){function u(e){s=Math.round((s+e)/2)}function l(e,t,n){var r=e+n/2-t;a=(f*a+r)/(f+1),f+=1}function c(){o=Date.now(),n.ping(function(e){var t=Date.now();u(t-o),l(o,e,t-o),setTimeout(c,i)})}var t=e("lodash"),n=e("modules/request"),r={},i=1e3,s=0,o=Date.now(),a=0,f=0;return r.on=function(){c()},r.get=function(){return s},r.dt=function(){return a},r}),define("modules/background",["require","pixi","modules/assets","modules/render","modules/camera"],function(e){var t=e("pixi"),n=e("modules/assets"),r=e("modules/render"),i=e("modules/camera"),s={},o=[];return s.create=function(e){var s=i.scale();o[0]=new t.TilingSprite(n.texture.bg_0,r.resolution[0]/s,r.resolution[1]/s),o[0].position.x=0,o[0].position.y=0,o[0].tilePosition.x=0,o[0].tilePosition.y=0,r.layers[0].addChild(o[0]),o[1]=new t.TilingSprite(n.texture.bg_1,r.resolution[0]/s,r.resolution[1]/s),o[1].position.x=0,o[1].position.y=0,o[1].tilePosition.x=0,o[1].tilePosition.y=0,r.layers[0].addChild(o[1]),o[2]=new t.TilingSprite(n.texture.bg_2,r.resolution[0]/s,r.resolution[1]/s),o[2].position.x=0,o[2].position.y=0,o[2].tilePosition.x=0,o[2].tilePosition.y=0,o[2].scale=new t.Point(s,s),r.layers[0].addChild(o[2]),o[3]=new t.TilingSprite(n.texture.bg_3,r.resolution[0]/s,r.resolution[1]/s),o[3].position.x=0,o[3].position.y=0,o[3].tilePosition.x=0,o[3].tilePosition.y=0,o[3].scale=new t.Point(s,s),r.layers[0].addChild(o[3])},s.update=function(){var e=i.position(),t=i.scale(),n=.05,s=1+n*(t-1);o[0].width=r.resolution[0]/s,o[0].height=r.resolution[1]/s,o[0].scale.x=s,o[0].scale.y=s,o[0].tilePosition.x=r.resolution[0]*(1/s-1)/2-e[0]*n,o[0].tilePosition.y=r.resolution[1]*(1/s-1)/2-e[1]*n,n=.1,s=1+n*(t-1),o[1].width=r.resolution[0]/s,o[1].height=r.resolution[1]/s,o[1].scale.x=s,o[1].scale.y=s,o[1].tilePosition.x=r.resolution[0]*(1/s-1)/2-e[0]*n,o[1].tilePosition.y=r.resolution[1]*(1/s-1)/2-e[1]*n,n=.2,s=1+n*(t-1),o[2].width=r.resolution[0]/s,o[2].height=r.resolution[1]/s,o[2].scale.x=s,o[2].scale.y=s,o[2].tilePosition.x=r.resolution[0]*(1/s-1)/2-e[0]*n,o[2].tilePosition.y=r.resolution[1]*(1/s-1)/2-e[1]*n,s=t,s>.47?(o[3].width=r.resolution[0]/s,o[3].height=r.resolution[1]/s,o[3].scale.x=s,o[3].scale.y=s,o[3].tilePosition.x=r.resolution[0]*(1/s-1)/2-e[0],o[3].tilePosition.y=r.resolution[1]*(1/s-1)/2-e[1],o[3].visible=!0):o[3].visible=!1},s}),define("games/game",["require","pixi","lodash","p2","modules/camera","modules/render","modules/assets","modules/request","modules/user","modules/key","modules/player","body/index","modules/ping","modules/background","modules/step"],function(e){var t=e("pixi"),n=e("lodash"),r=e("p2"),i=e("modules/camera"),s=e("modules/render"),o=e("modules/assets"),u=e("modules/request"),a=e("modules/user"),f=e("modules/key"),l=e("modules/player"),c=e("body/index"),h=e("modules/ping"),p=e("modules/background"),d=e("modules/step"),v={};return v.world,v.bodies={},v.users={},v.camera,v.background,v.lastGameStepTime,v.dataFromServer=[],v.updateData=[],v.ping=h.get(),v.serverSendStateInterval=0,v.state,v.isEnable=!0,v.loop=function(){var e=this,t=Date.now();if(t<this.lastGameStepTime)return;this.worldStep(t),this.update(t),s.draw(),this.lastGameStepTime=t,requestAnimFrame(function(){e.loop()}),this.render()},v.addUser=function(e){this.users[e.id]=e},v.removeUser=function(e){this.users[e.id]!==undefined&&delete this.users[e.id]},v.addBody=function(e){this.bodies[e.id]=e,e.addToGame(this)},v.removeBody=function(e){delete this.bodies[e.id],e.removeFromGame()},v.load=function(e,t){this.lastGameStepTime=Date.now(),o.load(e.game.assets,t)},v.updateFromServerEnable=function(){var e=this;u.onUpdateGameState(function(t){t[0]+=h.dt(),e.dataFromServer.push(t)})},v.updateImportant=function(e){var t=this,r=e[0]+this.ping;n(e[1][0]).forEach(function(e){t.bodies[e[0]]!==undefined&&t.bodies[e[0]].updateActions(r,e)}),e[2]&&(e[2][0]!==0&&n(e[2][0]).forEach(function(e){t.bodies[e[0]]===undefined&&t.addBody(c.create(e))}),e[2][1]!==0&&n(e[2][1]).forEach(function(e){var n;t.users[e[0]]===undefined&&(n=new a(e),t.addUser(n),e[3]&&n.setShip(t.bodies[e[3]]))}),this.state.newData(e[2])),e[3]&&(e[3][0]!==0&&n(e[3][0]).forEach(function(e){t.bodies[e]!==undefined?t.bodies[e].destroy():console.log("Error remove data "+e)}),this.state.removeData(e[2]))},v.updateFromDataServer=function(e){var t=this,r,i,s,o;this.dataFromServer.length>0&&(this.updateData=this.updateData.concat(this.dataFromServer),this.dataFromServer=[]),this.updateData=n.sortBy(this.updateData,0),r=[],n(this.updateData).forEach(function(n,i){n[0]<e-t.ping&&r.push(n)}),i=r.length,i>0&&(this.updateData=this.updateData.slice(i),n.forEach(r,function(e){t.updateImportant(e)}),s=r[i-1],o=(s[0]+this.ping-this.lastGameStepTime)/1e3,o>0&&(this.isEnable&&this.world.step(o),d.go(o)),n(s[1][0]).forEach(function(e){t.bodies[e[0]]!==undefined&&t.bodies[e[0]].update(s[0],e)}),this.lastGameStepTime=s[0]+this.ping)},v.worldStep=function(e){var t;this.updateFromDataServer(e),t=(e-this.lastGameStepTime)/1e3,t!==0&&(this.isEnable&&this.world.step(t),d.go(t))},v.start=function(e){var t=this,o;h.on(),this.serverSendStateInterval=e.game.sendStateInterval,this.world=new r.World({gravity:e.game.world.gravity,applyDamping:e.game.world.applyDamping}),this.camera=i.create(s.resolution[0],s.resolution[1]),i.set(this.camera),p.create(this),n(e.game.bodies).forEach(function(e){t.addBody(c.create(e))}),n(e.game.users).forEach(function(e){var n=new a(e);t.addUser(n),e[3]&&n.setShip(t.bodies[e[3]])}),u.onGameClose(n.bind(this.close,this)),this.disconnectEnable(),this.state.start({changeStatusData:e}),this.updateFromServerEnable(),this.loop()},v.update=function(e){this.ping=h.get()/2,this.camera.update(),n(v.bodies).forEach(function(t){t.updateSprite(e)}),p.update(),this.state.update(e),l.sendActionToServer(),f.reset()},v.render=function(){this.state.render()},v.changeState=function(e,t){this.state!==undefined&&(this.state.close(),e.start(t)),this.state=e},v.close=function(){this.isEnable=!1},v.disconnectEnable=function(){var e=this;u.disconnect(function(){e.isEnable=!1}),u.reconnect(function(){e.isEnable=!0})},v}),define("interface/frames/mainmenu",["require","interface/index"],function(e){var t=e("interface/index"),n={},r,i,s;return n.create=function(){r=t.frame.create({anchor:"CENTER",width:330,height:140,position:[-160,-70],color:"blue",visible:!1}),i=t.button.create({text:"Return to game",position:[15,15],color:"orange",click:function(){n.hide()}}),r.addChild(i),s=t.button.create({text:"Exit",position:[15,75],color:"green",click:function(){n.hide()}}),r.addChild(s)},n.show=function(){r.show()},n.hide=function(){r.hide()},n.toggle=function(){r.toggle()},n}),define("interface/screenarrow",["require","lodash","pixi","modules/assets","modules/render"],function(e){var t=e("lodash"),n=e("pixi"),r=e("modules/assets"),i=e("modules/render"),s=function(t){this.padding=30,this.sprite,this.text,this.camera,this.setCamera(t.camera),this.target=[0,0],this.getTargetPosition=this.getPointPosition,this.followTo(t.target),this.createSprite()};return s.prototype.followTo=function(e){t.isArray(e)?(this.target=e,this.getTargetPosition=this.getPointPosition):e.body!==undefined?(this.target=e,this.getTargetPosition=this.getBodyPosition):typeof e=="function"&&(this.target=undefined,this.getTargetPosition=e)},s.prototype.getPointPosition=function(){return[this.target[0],this.target[1]]},s.prototype.getBodyPosition=function(){return[this.target.body.position[0],this.target.body.position[1]]},s.prototype.createSprite=function(){this.sprite=new n.Sprite(r.texture.screenArrow),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,i.layers[4].addChild(this.sprite)},s.prototype.createText=function(){this.text=new n.Text("0",{fill:"#AD0F0F"}),i.layers[4].addChild(this.text)},s.prototype.setCamera=function(e){this.camera=e,this.cameraCornerAngle=[],this.cameraCornerAngle[1]=Math.atan2(this.camera.height,this.camera.width),this.cameraCornerAngle[0]=Math.atan2(this.camera.height,-this.camera.width),this.cameraCornerAngle[2]=-this.cameraCornerAngle[0],this.cameraCornerAngle[3]=-this.cameraCornerAngle[1]},s.prototype.getSpritePosition=function(){var e=this.getTargetPosition(),t=this.camera.position,n=-Math.atan2(e[1]-t[1],e[0]-t[0]),r=[];return n>this.cameraCornerAngle[3]&&n<=this.cameraCornerAngle[1]?(r[0]=this.camera.width-this.padding,r[1]=this.camera.height/2-(this.camera.width/2-this.padding)*Math.tan(n)):n>this.cameraCornerAngle[1]&&n<=this.cameraCornerAngle[0]?(r[1]=this.padding,r[0]=this.camera.width/2+(this.camera.height/2-this.padding)/Math.tan(n)):n>this.cameraCornerAngle[0]&&n<=Math.PI||n<=this.cameraCornerAngle[2]&&n>-Math.PI?(r[0]=this.padding,r[1]=this.camera.height/2+(this.camera.width/2-this.padding)*Math.tan(n)):n>this.cameraCornerAngle[2]&&n<=this.cameraCornerAngle[3]&&(r[1]=this.camera.height-this.padding,r[0]=this.camera.width/2-(this.camera.height/2-this.padding)/Math.tan(n)),{position:r,angle:-n}},s.prototype.update=function(){var e;this.camera.containsSprite(this.target.sprite)?this.sprite.visible=!1:(e=this.getSpritePosition(),this.sprite.position.x=e.position[0],this.sprite.position.y=e.position[1],this.sprite.rotation=e.angle,this.sprite.visible=!0)},s}),define("modules/debug",["require","lodash","pixi","modules/render","modules/request","modules/ping"],function(e){var t=e("lodash"),n=e("pixi"),r=e("modules/render"),i=e("modules/request"),s=e("modules/ping"),o={},u,a;return o.pingOn=function(){u=new n.Text(s.get()+"ms",{font:"normal 18px Arial",fill:"#fff"}),u.position.x=10,u.position.y=10,r.layers[4].addChild(u),a=new n.Text(s.get()+"ms",{font:"normal 18px Arial",fill:"#fff"}),a.position.x=10,a.position.y=40,r.layers[4].addChild(a)},o.pingOff=function(){r.layers[4].removeChild(u),u=undefined},o.update=function(){u!==undefined&&u.setText(s.get()+"ms"),a!==undefined&&a.setText("dt: "+Math.floor(s.dt()*1e3)/1e3)},o}),define("games/first/mainstate",["require","lodash","games/game","modules/key","modules/player","interface/frames/mainmenu","interface/screenarrow","interface/index","modules/debug","modules/render"],function(e){var t=e("lodash"),n=e("games/game"),r=e("modules/key"),i=e("modules/player"),s=e("interface/frames/mainmenu"),o=e("interface/screenarrow"),u=e("interface/index"),a=e("modules/debug"),f=e("modules/render"),l={};return l.start=function(e){i.setUser(n.users[e.changeStatusData.user[0]||e.user[0]]),n.camera.followTo(i.user.ship),this.scrArrow=new o({camera:n.camera,target:n.bodies[1]}),t(n.users).forEach(function(e){u.bodyInfo.create({body:e.ship})}),a.pingOn(),i.user.ship.weaponsAimActivate(),s.create()},l.update=function(e){r.pressed.WHEELDOWN?n.camera.zoomOut():r.pressed.WHEELUP&&n.camera.zoomIn(),r.down.W?i.action(e,1):r.down.S&&i.action(e,2),r.down.A?i.action(e,3):r.down.D?i.action(e,4):r.down.Q?i.action(e,6):r.down.E?i.action(e,7):!r.down.CTRL&&i.user.ship.body.angularVelocity!==0&&i.action(e,8),r.down.MOUSELEFT&&i.action(e,5),r.pressed.ESC&&s.toggle(),i.user.ship.weaponsGoto(f.stage.getMousePosition()),this.scrArrow.update(),u.bodyInfo.update(),a.update()},l.render=function(){},l.close=function(){},l.newData=function(e){t(e[1]).forEach(function(e){u.bodyInfo.create({body:n.users[e[0]].ship})})},l.removeData=function(e){},l}),define("modules/valid",["require"],function(e){var t={};return t.passwordLength=function(e){return e.length>3},t.passwordsConfirm=function(e,t){return e===t},t.email=function(e){return/.+@.+\..+/i.test(e)},t.name=function(e){return e.length>3&&!/[^a-z0-9\s]/i.test(e)},t}),define("games/first/enter",["require","lodash","pixi","games/game","modules/key","interface/index","./mainstate","modules/valid","json!config","modules/request"],function(e){function c(){var e,t,n;l.firstMenu=s.frame.create({anchor:"CENTER"}),e=s.button.create({text:"Quick start",click:function(){f.quickStart(),l.proposeSignUp=!0},position:[-150,-85]}),l.firstMenu.addChild(e)}function h(){var e,t,n;l.loginMenu=s.frame.create({anchor:"CENTER",visible:!1,onShow:function(){e.active()}}),l.loginMenu.addChild(s.text.create({text:"Log in",position:[0,-120],anchor:[.5,1]})),e=s.editbox.create({position:[-150,-115],onNext:function(){t.active()}}),l.loginMenu.addChild(e),e.addChild(s.text.create({text:"E-mail",position:[-5,25],anchor:[1,.5]})),t=s.editbox.create({color:"red",position:[-150,-55],type:"pass",onNext:function(){n.click()}}),l.loginMenu.addChild(t),t.addChild(s.text.create({text:"Password",position:[-5,25],anchor:[1,.5]})),n=s.button.create({color:"orange",text:"Ok",position:[-150,5],click:function(){var n=e.value(),r=t.value(),i=!1;u.email(n)?u.passwordLength(r)?i=!0:error.setText(a.errors.minPasswordLength):error.setText(a.errors.emailNotValid),i&&f.login(n,r,function(e){e.error===1?error.setText(a.errors.unknownEmailOrPass):l.loginMenu.hide()})}}),l.loginMenu.addChild(n),l.loginMenu.addChild(s.button.create({color:"green",text:"Back",position:[-150,65],click:function(){l.loginMenu.hide(),l.firstMenu.show()}})),error=s.text.create({text:"",color:"ff0000",position:[160,30],fontSize:18,anchor:[0,.5]}),l.loginMenu.addChild(error)}function p(){var e,t,n,r,i;l.regMenu=s.frame.create({anchor:"CENTER",visible:!1,onShow:function(){e.active()}}),l.regMenu.addChild(s.text.create({text:"Sign up",position:[0,-150],anchor:[.5,1]})),e=s.editbox.create({position:[-150,-145],onNext:function(){t.active()}}),l.regMenu.addChild(e),e.addChild(s.text.create({text:"E-mail",position:[-5,25],anchor:[1,.5]})),t=s.editbox.create({color:"red",position:[-150,-85],type:"pass",onNext:function(){n.active()}}),l.regMenu.addChild(t),t.addChild(s.text.create({text:"Password",position:[-5,25],anchor:[1,.5]})),n=s.editbox.create({color:"red",position:[-150,-25],type:"pass",onNext:function(){r.click()}}),l.regMenu.addChild(n),n.addChild(s.text.create({text:"Confirm password",position:[-5,25],anchor:[1,.5]})),r=s.button.create({color:"orange",text:"Ok",position:[-150,35],click:function(){var r=e.value(),s=t.value(),o=n.value(),c=!1;u.email(r)?u.passwordLength(s)?u.passwordsConfirm(s,o)?c=!0:i.setText(a.errors.passwordsDontMatch):i.setText(a.errors.minPasswordLength):i.setText(a.errors.emailNotValid),c&&f.signUp(r,s,function(e){e.error===1?i.setText(a.errors.emailBusy):e.error===500?i.setText(a.errors.serverError):(l.regMenu.hide(),l.choiceMenu.show())})}}),l.regMenu.addChild(r),l.regMenu.addChild(s.button.create({color:"green",text:"Back",position:[-150,95],click:function(){l.regMenu.hide(),l.firstMenu.show()}})),i=s.text.create({text:"",color:"ff0000",position:[160,60],fontSize:18,anchor:[0,.5]}),l.regMenu.addChild(i)}function d(){var e,t,n;l.choiceMenu=s.frame.create({anchor:"CENTER",visible:!1,onShow:function(){e.active()}}),l.choiceMenu.addChild(s.text.create({text:"Enter your name",position:[0,-60],anchor:[.5,1]})),e=s.editbox.create({position:[-150,-55],onNext:function(){n.click()}}),l.choiceMenu.addChild(e),n=s.button.create({color:"orange",text:"Ok",position:[-150,5],click:function(){var n=e.value();u.name(n)?f.enterName(n,function(e){e.error===1?t.setText(a.errors.nameBusy):e.error===500?t.setText(a.errors.serverError):l.choiceMenu.hide()}):t.setText(a.errors.nameNotValid)}}),l.choiceMenu.addChild(n),t=s.text.create({text:"",color:"ff0000",position:[160,30],fontSize:18,anchor:[0,.5]}),l.choiceMenu.addChild(t)}var t=e("lodash"),n=e("pixi"),r=e("games/game"),i=e("modules/key"),s=e("interface/index"),o=e("./mainstate"),u=e("modules/valid"),a=e("json!config"),f=e("modules/request"),l={};return l.firstMenu,l.loginMenu,l.regMenu,l.followBodyNumber,l.playerId,l.proposeSignUp=!1,l.start=function(){this.followBodyNumber=1,r.camera.followTo(r.bodies[this.followBodyNumber]),c(),this.lastTimeChangeCamera=Date.now(),f.changeStatusToPlayer(function(e){l.changeStatusData=e})},l.update=function(){function n(){l.lastTimeChangeCamera=e,l.followBodyNumber=l.followBodyNumber%t.size(r.bodies)+1,r.camera.followTo(r.bodies[l.followBodyNumber])}var e=Date.now();(i.pressed.SPACE||e-this.lastTimeChangeCamera>7e3)&&n(),this.changeStatusData!==undefined&&r.users[this.changeStatusData.user[0]]!==undefined&&this.next()},l.render=function(){},l.close=function(){this.firstMenu.hide()},l.next=function(){var e={changeStatusData:this.changeStatusData,proposeSignUp:this.proposeSignUp};r.changeState(o,e)},l.newData=function(){},l.removeData=function(){},l}),define("main",["require","modules/request","games/game","modules/render","games/first/enter","games/first/mainstate","interface/position"],function(e){var t=e("modules/request"),n=e("games/game"),r=e("modules/render"),i=e("games/first/enter"),s=e("games/first/mainstate"),o=e("interface/position");t.gameInit(function(e){n.load(e,function(){r.create(),o.update(),e.user[1]===0?n.changeState(i):n.changeState(s),n.start(e)})})}),window.JS_ENV=window.JS_ENV||"production",console.log("Development mode enable"),require.config({baseUrl:"js/lib",paths:{socketio:"/socket.io/socket.io.js",game:"../game",config:"../config.json",body:"../body",modules:"../modules",games:"../games",main:"../main",actions:"../actions","interface":"../interface"}}),require(["main"]),define("../app",function(){});